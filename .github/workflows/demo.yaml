name: NASA APOD Matrix Warmup

on:
  push:
    branches:
      - main

jobs:
  fetch-apod:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        request:
          - name: "today_apod"
            query: "date=2025-12-03"
          - name: "yesterday_apod"
            query: "date=2025-12-02"
          - name: "random_apod"
            query: "count=1"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Call NASA APOD API
        run: |
          # Read the API key from a repository secret
          API_KEY="${{ secrets.NASA_API_KEY }}"

          # Build the APOD URL using the matrix query value
          URL="https://api.nasa.gov/planetary/apod?${{ matrix.request.query }}&api_key=$API_KEY"

          echo "Calling: $URL"
          curl "$URL" -o apod.json

          echo "API response:"
          cat apod.json

          # Extract the HD image URL from the JSON
          HDURL=$(jq -r '.[0].hdurl // .[0].url' apod.json)
          echo "HDURL is: $HDURL"

          # Download the image into the images/ folder
          mkdir -p images
          curl "$HDURL" -o "images/${{ matrix.request.name }}.jpg"

      - name: Upload APOD images
        uses: actions/upload-artifact@v4
        with:
          name: apod-images
          path: images/
